<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Google Cloud Spanner C++ Client: Cloud Spanner C++ Client Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Google Cloud Spanner C++ Client
   </div>
   <div id="projectbrief">A C++ Client Library for Google Cloud Spanner</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Cloud Spanner C++ Client Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Cloud Spanner C++ Client library offers types and functions to use Cloud Spanner from C++11 applications.</p>
<p>This library requires a C++11 compiler, it is supported (and tested) on multiple Linux distributions.</p>
<h2>Quickstart</h2>
<p>The following instructions show you how to perform basic tasks in Cloud Spanner using the C++ client library.</p>
<h3>Before you begin</h3>
<ol type="1">
<li>Select or create a Google Cloud Platform (GCP) project using the <a href="https://console.cloud.google.com/cloud-resource-manager" title="Console Resource Manager">manage resource page</a>. Make a note of the project id, you will need to use it later.</li>
<li>Make sure that <a href="https://cloud.google.com/billing/docs/how-to/modify-project" title="How to: Modify Project">billing is enabled</a> for your project.</li>
<li>Learn about <a href="https://cloud.google.com/storage/docs/concepts" title="GCS Concepts">key terms and concepts</a> for Cloud Spanner.</li>
<li>Setup the authentication for the examples:<ul>
<li><a href="https://cloud.google.com/docs/authentication/getting-started" title="Authentication Getting Started">Configure a service account</a>,</li>
<li>or <a href="https://cloud.google.com/sdk/docs/quickstarts">login with your personal account</a></li>
</ul>
</li>
</ol>
<h3>Downloading and Compiling the C++ Client Library</h3>
<p>The source code for the Cloud Spanner C++ Client Library can be found on <a href="https://github.com/googleapis/google-cloud-cpp-spanner" title="GitHub Repository">GitHub</a>. Download or clone this repository as usual:</p>
<div class="fragment"><div class="line">git clone https:<span class="comment">//github.com/googleapis/google-cloud-cpp-spanner.git</span></div></div><!-- fragment --><p>The top-level <a href="https://github.com/googleapis/google-cloud-cpp-spanner/blob/master/README%2Emd">README</a> file in this repository includes detailed instructions on how to compile the library. The examples used in this guide should be automatically compiled when you follow said instructions.</p>
<h3>Configuring authentication for the C++ Client Library</h3>
<p>Like all Google Cloud Platform (GCP) services, Cloud Spanner requires that your application authenticates with the service before accessing any data. If you are not familiar with GCP authentication please take this opportunity to review the <a href="https://cloud.google.com/docs/authentication/getting-started" title="Authentication Getting Started">Authentication Overview</a>. This library uses the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable to find the credentials file. For example:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Shell  </th><th class="markdownTableHeadNone">Command   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Bash/zsh/ksh/etc.  </td><td class="markdownTableBodyNone"><code>export GOOGLE_APPLICATION_CREDENTIALS=[PATH]</code>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">sh  </td><td class="markdownTableBodyNone"><code>GOOGLE_APPLICATION_CREDENTIALS=[PATH];</code> <code>export GOOGLE_APPLICATION_CREDENTIALS</code>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">csh/tsch  </td><td class="markdownTableBodyNone"><code>setenv GOOGLE_APPLICATION_CREDENTIALS [PATH]</code>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Windows Powershell  </td><td class="markdownTableBodyNone"><code>$env:GOOGLE_APPLICATION_CREDENTIALS=[PATH]</code>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Windows cmd.exe  </td><td class="markdownTableBodyNone"><code>set GOOGLE_APPLICATION_CREDENTIALS=[PATH]</code>   </td></tr>
</table>
<p>Setting this environment variable is the recommended way to configure the authentication preferences, though if the environment variable is not set, the library searches for a credentials file in the same location as the <a href="https://cloud.google.com/sdk/">Cloud SDK</a>.</p>
<h3>Create a database</h3>
<p>This is a short example that creates a Cloud Spanner database and two tables. This example assumes you have configured the authentication using <code>GOOGLE_APPLICATION_CREDENTIALS</code> and has created a Cloud Spanner instance:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Quickstart(std::string <span class="keyword">const</span>&amp; project_id, std::string <span class="keyword">const</span>&amp; instance_id,</div><div class="line">                std::string <span class="keyword">const</span>&amp; database_id) {</div><div class="line">  <span class="keyword">namespace </span><a class="code" href="namespacegoogle_1_1cloud_1_1spanner.html">spanner</a> = <a class="code" href="namespacegoogle_1_1cloud_1_1spanner.html">google::cloud::spanner</a>;</div><div class="line"></div><div class="line">  spanner::Client client(<a class="code" href="namespacegoogle_1_1cloud_1_1spanner_1_1v0.html#a34e43f27057136f44b36251a0a379c1b">spanner::MakeConnection</a>(</div><div class="line">      spanner::Database(project_id, instance_id, database_id)));</div><div class="line"></div><div class="line">  <span class="keyword">auto</span> reader =</div><div class="line">      client.ExecuteSql(spanner::SqlStatement(<span class="stringliteral">&quot;SELECT &#39;Hello World&#39;&quot;</span>));</div><div class="line">  <span class="keywordflow">if</span> (!reader) <span class="keywordflow">throw</span> std::runtime_error(reader.status().message());</div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> row : reader-&gt;Rows&lt;std::string&gt;()) {</div><div class="line">    <span class="keywordflow">if</span> (!row) <span class="keywordflow">throw</span> std::runtime_error(row.status().message());</div><div class="line">    std::cout &lt;&lt; row-&gt;get&lt;0&gt;() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> This quickstart creates a database with two tables: <code>Singers</code> and <code>Albums</code>. You must provide the project id and instance in the command-line when you run the quickstart program. Assuming you followed the build instructions referenced above this would be:</p>
<div class="fragment"><div class="line">./cmake-out/<a class="code" href="namespacegoogle.html">google</a>/cloud/<a class="code" href="namespacegoogle_1_1cloud_1_1spanner.html">spanner</a>/samples/samples [PROJECT_ID] [INSTANCE_ID]</div></div><!-- fragment --><h3>Using the library in your own projects</h3>
<p>Our continuous integration builds compile and test the code using both <a href="https://bazel.build/">Bazel</a>, and <a href="https://cmake.org/">CMake</a>. Integrating the Cloud Spanner C++ client library should work with either.</p>
<h4>Integrating with CMake</h4>
<p>Compile and install the library using the usual <code>CMake</code> commands. Once the library is installed, you can use it in your <code>CMakeLists.txt</code> file like any other package:</p>
<div class="fragment"><div class="line">cmake_minimum_required(VERSION 3.5)</div><div class="line">find_package(spanner_client REQUIRED)</div><div class="line"></div><div class="line">add_executable(my_program my_program.cc)</div><div class="line">target_link_libraries(my_program spanner_client)</div></div><!-- fragment --><h4>Integrating with Bazel</h4>
<p>As we do not currently have releases of <code>google-cloud-cpp-spanner</code> you need to select the SHA-1 of the <a href="https://github.com/googleapis/google-cloud-cpp-spanner/commits/master">commit</a> you want to use.</p>
<p>In your <a href="https://docs.bazel.build/versions/master/build-ref.html#packages_targets">WORKSPACE</a> file add a dependency to download and install the library, for example:</p>
<div class="fragment"><div class="line"><span class="comment"># Change the version and SHA256 hash as needed.</span></div><div class="line">http_archive(</div><div class="line">    name = <span class="stringliteral">&quot;com_github_googleapis_google_cloud_cpp_spanner&quot;</span>,</div><div class="line">    url = <span class="stringliteral">&quot;https://github.com/googleapis/google-cloud-cpp-spanner/archive/e2e73b6b044233a51d00090f1f09cd1b7b3af76b.tar.gz&quot;</span>,</div><div class="line">    strip_prefix = <span class="stringliteral">&quot;google-cloud-cpp-spanner-e2e73b6b044233a51d00090f1f09cd1b7b3af76b&quot;</span>,</div><div class="line">    sha256 = <span class="stringliteral">&quot;f1b4f3a35b89545d904a9484f38b984cd21f1d8c2e50f9ab21f3ba988cfe11e2&quot;</span>,</div><div class="line">)</div></div><!-- fragment --><p>Then load the dependencies of the library:</p>
<div class="fragment"><div class="line">load(<span class="stringliteral">&quot;@com_github_googleapis_google_cloud_cpp_spanner//bazel:google_cloud_cpp_spanner_deps.bzl&quot;</span>, <span class="stringliteral">&quot;google_cloud_cpp_spanner_deps&quot;</span>)</div><div class="line"></div><div class="line">google_cloud_cpp_spanner_deps()</div><div class="line"></div><div class="line"><span class="comment"># Configure @com_google_googleapis to only compile C++ and gRPC:</span></div><div class="line">load(<span class="stringliteral">&quot;@com_google_googleapis//:repository_rules.bzl&quot;</span>, <span class="stringliteral">&quot;switched_rules_by_language&quot;</span>)</div><div class="line"></div><div class="line">switched_rules_by_language(</div><div class="line">    name = <span class="stringliteral">&quot;com_google_googleapis_imports&quot;</span>,</div><div class="line">    cc = <span class="keyword">True</span>,</div><div class="line">    grpc = <span class="keyword">True</span>,</div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment"># You have to manually call the corresponding function for google-cloud-cpp and</span></div><div class="line"><span class="comment"># gRPC:  https://github.com/bazelbuild/bazel/issues/1550</span></div><div class="line">load(<span class="stringliteral">&quot;@com_github_googleapis_google_cloud_cpp//bazel:google_cloud_cpp_deps.bzl&quot;</span>, <span class="stringliteral">&quot;google_cloud_cpp_deps&quot;</span>)</div><div class="line"></div><div class="line">google_cloud_cpp_deps()</div><div class="line"></div><div class="line">load(<span class="stringliteral">&quot;@com_github_grpc_grpc//bazel:grpc_deps.bzl&quot;</span>, <span class="stringliteral">&quot;grpc_deps&quot;</span>)</div><div class="line"></div><div class="line">grpc_deps()</div></div><!-- fragment --><p>You can now use the library as a dependency in your BUILD files, for example:</p>
<div class="fragment"><div class="line">cc_binary(</div><div class="line">    name = <span class="stringliteral">&quot;my_program&quot;</span>,</div><div class="line">    srcs = [</div><div class="line">        <span class="stringliteral">&quot;my_program.cc&quot;</span>,</div><div class="line">    ],</div><div class="line">    deps = [</div><div class="line">        <span class="stringliteral">&quot;@com_github_googleapis_google_cloud_cpp_spanner//google/cloud/spanner:spanner_client&quot;</span>,</div><div class="line">    ],</div><div class="line">)</div></div><!-- fragment --><h4>Integrating with Make</h4>
<p>Installing the client library with CMake also creates <code>pkg-config</code> support files for application developers that prefer to use <code>Make</code> as their build system. Once the library is installed, you can use it in your <code>Makefile</code> like any other <code>pkg-config</code> module:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Configuration variables to compile and link against the Cloud Spanner C++</span></div><div class="line"><span class="preprocessor"># client library.</span></div><div class="line">SPANNER_CXXFLAGS   := $(shell pkg-config spanner_client --cflags)</div><div class="line">SPANNER_CXXLDFLAGS := $(shell pkg-config spanner_client --libs-only-L)</div><div class="line">SPANNER_LIBS       := $(shell pkg-config spanner_client --libs-only-l)</div><div class="line"></div><div class="line"># A target <span class="keyword">using</span> the Cloud Spanner C++ client library.</div><div class="line">my_program: my_program.cc</div><div class="line">    $(CXX) $(CXXFLAGS) $(SPANNER_CXXFLAGS) $(SPANNER_CXXLDFLAGS) -o $@ $^ $(SPANNER_LIBS)</div></div><!-- fragment --><h3>Error Handling</h3>
<p>This library never throws exceptions to signal error. In general, the library returns a <a href="https://github.com/googleapis/google-cloud-cpp/blob/master/google/cloud/status_or.h"><code>StatusOr&lt;T&gt;</code></a> if an error is possible. Some functions return objects that are not wrapped in a <code>StatusOr&lt;&gt;</code> but will themselves return a <code>StatusOr&lt;T&gt;</code> to signal an error. For example, wrappers for long running operations return <code>future&lt;StatusOr&lt;T&gt;&gt;</code>.</p>
<h3>Retry, Backoff, and Idempotency Policies.</h3>
<p>The library automatically retries requests that fail with transient errors, and follows the recommended practices with respect to backoff between retries. Application developers can override the default <a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v0.html#a7ac0157ff53ff117cda2ebfe18650481">retry</a> and <a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v0.html#a9ad3c388cccb2c4d92c8299ac178af8a">backoff</a> policies.</p>
<p>The default policies are to continue retrying for up to 15 minutes, and to use truncated (at 5 minutes) exponential backoff, doubling the maximum backoff period between retries.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v0.html#ab1f307578e2cae145104cae9703811a1">LimitedTimeRetryPolicy</a> and <a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v0.html#a261401d138e3aa98ea260e0fc1e95637">LimitedErrorCountRetryPolicy</a> for alternative retry policies.</dd>
<dd>
<a class="el" href="namespacegoogle_1_1cloud_1_1spanner_1_1v0.html#ada6ef35eea8a9d9c239e32683a823010">ExponentialBackoffPolicy</a> to configure different parameters for the exponential backoff policy.</dd></dl>
<h2>Next Steps</h2>
<p><a class="el" href="spanner-mocking.html">Mocking the Cloud Spanner C++ Client with Google Mock.</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
